<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/loginPage.css" rel="stylesheet" />
	</head>

	<body>
		<div class="mui-content contentCenter">
			<div class="backgroundFilter"></div>
			<ul class="loginList">
				<li class="input">
					<div class="mui-input-row">
						<input id="account" type="text" class="mui-input-clear" placeholder="account">
					</div>
				</li>
				<li class="input">
					<div class="mui-input-row">
						<input id="password" type="password" class="mui-input-clear" placeholder="password">
					</div>
				</li>
				<li class="input">
					<button type="button" class="mui-btn mui-btn-block">LOGIN IN</button>
				</li>
				<li class="input">
					<a href="#">我要注册 </a>|
					<a href="#"> 忘记密码？</a>
				</li>
			</ul>
		</div>
		<script src="../js/mui.min.js"></script>
		<script type="text/javascript">
			var loginBtn = null;
			var account = null;
			var passWord = null;
			mui.init();
			mui.plusReady(function() {
				menu = plus.webview.getWebviewById('menu');
			});
			loginBtn = document.querySelector('button');
			loginBtn.addEventListener('tap', function() {
				account = document.getElementById('account').value;
				passWord = document.getElementById('password').value;
				if(account == '' || passWord == '') {
					mui.toast("账号、密码不可为空");
					return;
				};
				mui.ajax("../data/login.json", {
					data: {
						Account: account,
						PassWord: passWord
					},
					dataType: "json",
					type: "POST",
					headers: {
						'Content-Type': 'application/json'
					},
					timeout: 10000,
					success: function(data) {
						if(data.Account == account && data.PassWord == passWord) {
							document.querySelector('#account').parentNode.parentNode.style = "";
							document.querySelector('#password').parentNode.parentNode.style = "";
							 
							//本地存储用户个人信息
//							setCookie("adminAccount", data.Account,365);
							localStorage.setItem("adminAccount", data.Account);
							plus.webview.currentWebview().opener().reload();
							setTimeout(function() {
								mui.back();
							}, 200);
						} else {
							if(data.Account == account) {
								document.querySelector('#account').parentNode.parentNode.style = "";
								document.querySelector('#password').parentNode.parentNode.style.borderColor = "red";
							} else {
								document.querySelector('#account').parentNode.parentNode.style.borderColor = "red";
							}
						}
					},
					error: function(xhr, type, errorThrown) {
						mui.toast(type);
					}
				});
				//				mui.fire("loginIn", menu);
			});

			//写cookies
			function setCookie(cname, cvalue, exdays) {
				var d = new Date();
				d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
				var expires = "expires=" + d.toGMTString();
				document.cookie = cname + "=" + cvalue + "; " + expires;
			}

			function getCookie(cname) {
				var name = cname + "=";
				var ca = document.cookie.split(';');
				for(var i = 0; i < ca.length; i++) {
					var c = ca[i].trim();
					if(c.indexOf(name) == 0) return c.substring(name.length, c.length);
				}
				return "";
			}
		</script>
	</body>

</html>